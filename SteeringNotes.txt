Steering Commands
    - straight is 100
    - max right right is 30
    - max left is 170

Teleop anglue magnitude needs to be 13 or higher for full servo actuation

FOR TESTING STRAIGHT LINE:

ros2 topic pub --once /cmd_vel geometry_msgs/msg/Twist "{linear: {x: 0.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 0}}"

50,60,175

hostname - I

ros2 launch display.launch.py slam:=true

ros2 launch rplidar_ros rplidar_a1_launch.py

ros2 run teleop_twist_keyboard teleop_twist_keyboard

ros2 run v4l2_camera v4l2_camera_node

ros2 run ros2_pca9685 listener



fixed frame should be map
change reliability policy to reliable
change durability policy

ros2 lifecycle set /map_server configure
ros2 lifecycle set /map_server activate

ros2 run tf2_tools view_frames


ros2 lifecycle set /amcl configure
ros2 lifecycle set /amcl activate
ros2 lifecycle get /amcl



import os
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument, TimerAction, ExecuteProcess
from launch.substitutions import LaunchConfiguration
from launch_ros.actions import Node
from nav2_common.launch import RewrittenYaml

def generate_launch_description():
    use_sim_time = LaunchConfiguration('use_sim_time')
    map_yaml_file = LaunchConfiguration('map')
    params_file = LaunchConfiguration('params_file')

    lifecycle_nodes = ['map_server', 'amcl']

    remappings = [('/tf', 'tf'), ('/tf_static', 'tf_static')]

    param_substitutions = {
        'use_sim_time': use_sim_time,
        'yaml_filename': map_yaml_file
    }

    configured_params = RewrittenYaml(
        source_file=params_file,
        root_key='',
        param_rewrites=param_substitutions,
        convert_types=True
    )

    return LaunchDescription([
        DeclareLaunchArgument(
            'map', default_value='/home/kingpooper/deepRacerWS/my_map.yaml',
            description='Full path to map yaml file to load'
        ),
        DeclareLaunchArgument(
            'use_sim_time', default_value='true',
            description='Use simulation clock if true'
        ),
        DeclareLaunchArgument(
            'params_file',
            default_value='/home/kingpooper/deepRacerWS/src/robot_car/config/nav2_params.yaml',
            description='Full path to the ROS2 parameters file to use'
        ),

        Node(
            package='tf2_ros',
            executable='static_transform_publisher',
            name='static_tf_base_to_laser',
            arguments=['0', '0', '0', '0', '0', '0', 'base_link', 'laser']
        ),

        Node(
            package='nav2_map_server',
            executable='map_server',
            name='map_server',
            output='screen',
            parameters=[configured_params],
            remappings=remappings
        ),

        Node(
            package='nav2_amcl',
            executable='amcl',
            name='amcl',
            output='screen',
            parameters=[configured_params],
            remappings=remappings
        ),

        Node(
            package='nav2_lifecycle_manager',
            executable='lifecycle_manager',
            name='lifecycle_manager_localization',
            output='screen',
            parameters=[{
                'use_sim_time': use_sim_time,
                'autostart': True,
                'node_names': lifecycle_nodes
            }]
        ),

        Node(
            package='rviz2',
            executable='rviz2',
            name='rviz2',
            output='screen',
            arguments=['-d', '/home/kingpooper/deepRacerWS/src/robot_car/rviz/localization.rviz'],
            parameters=[{'use_sim_time': use_sim_time}]
        ),

        TimerAction(
            period=5.0,
            actions=[
                ExecuteProcess(
                    cmd=[
                        'ros2', 'topic', 'pub', '--once', '/initialpose',
                        'geometry_msgs/msg/PoseWithCovarianceStamped',
                        '{header: {frame_id: "map"}, pose: {pose: {position: {x: 0.0, y: 0.0, z: 0.0}, orientation: {x: 0.0, y: 0.0, z: 0.0, w: 1.0}}, '
                        'covariance: [0.25, 0.0, 0.0, 0.0, 0.0, 0.0, '
                        '0.0, 0.25, 0.0, 0.0, 0.0, 0.0, '
                        '0.0, 0.0, 0.0, 0.0, 0.0, 0.0, '
                        '0.0, 0.0, 0.0, 0.0, 0.0, 0.0, '
                        '0.0, 0.0, 0.0, 0.0, 0.0, 0.0, '
                        '0.0, 0.0, 0.0, 0.0, 0.0, 0.068]}'
                    ],
                    shell=True
                )
            ]
        )
    ])
